# 实现领域模型

实现领域模型，就是用软件把领域模型在软件系统中实现，从而得到最终可以满足需求，解决用户问题的软件系统。这是使用 DDD 的终极目的。

## 某某代码应该写在哪个层哪个包？

所有的领域逻辑，都应该尽量写到领域模块里，所有的非领域逻辑，都应该尽量不写入领域模块内。本指南并不对领域模块之外的代码该如何组织给出建议。

从通用编程原则来说，应该遵循封装和最小访问距离原则

- 一个代码应该尽量放到更小的可见范围内
- 一个代码应该写到离使用者最近的地方

## 编码太低级了，我用 DDD 就是为了做高级的架构

认为编码低级，搞架构设计才高级的，必定是愚蠢又充满危害的行业蛀虫，这些人多半都是没有真才实学，靠忽悠外行的老板来赚钱的骗子。

软件开发行业，架构设计一定是服务于最终的编码的，所有会架构设计的架构师必定先是编码的高手。编码都不行，还夸口软件架构，就如同说“何不食肉糜”一般可笑。

DDD 从来就不是高高在上的高级的方法论，就是服务于基础的编码工作的方法论。掌握好 DDD，必定以掌握编码为前提。

## 是不是应该在把模型都设计得完美之后再开始实现模型？

否。虽然我们强调要先建模再实现模型，但是整个过程是一个迭代的过程，在有了初步的聚合模型后，就可以开始直接写代码来实现它。这样做的好处是，我们可以尽早发现实现中的难题，尽早反馈给建模，调整模型。另外一方面，对于一个复杂的系统，可能有很多的聚合，很多的事件命令，在完成一部分的建模后，就开始实现这部分模型，也可以提升并行度，提升整体项目的开发效率。

## 发现模型不好实现，可以去回头修改模型吗？

可以。领域模型必须既解决用户问题，又能够被软件实现，甚至于容易被软件实现。如果实现过程中发现之前的领域模型设计不能实现，或者不容易实现，因此去修改模型，那是很自然的事情。

多练习建模，多掌握实现模型的技巧，有助于建模出可实现容易实现的模型。

## 是否可以只建模，但是实现的时候不按模型来呢？

不可以。如此，犹如买椟还珠。长此以往，大家会渐渐觉得投入那么多精力在建模上是没有多大意义的，还不如抛弃建模，彻底抛弃 DDD。而且，一旦不按照领域模型去实现代码，那么代码和领域模型脱节，很快新需求来的时候，之前的模型也失去了反应业务的能力。为了实现新功能，大家还是会从当前的代码出发去做技术方案，把之前的领域模型抛弃掉。

让领域模型和代码保持对应关系，这样才能在后续的开发过程中，通过领域模型不断快速了解问题域和系统的运作，从而给出解决新需求的合适的领域模型的变更。发挥出了领域模型的力量才能最终发挥出 DDD 的力量。

## 我们架构组建好了模型，但是负责实现模型的程序员们不知道如何实现模型，不愿意实现模型，怎么办？

首先，采用 DDD 之初，就应该对团队进行 DDD 技能的训练，至少所有队员能够理解模型，知道如何实现模型。

其次，负责建模的人，应该身先士卒，主动去实现一些模型做出示范。不能指望一小部分人商量出一个领域模型文档，把文档扔给负责实现的人，就万事大吉了。文档没法完全传递所有信息，领域模型不一定能够或者容易被实现。

再次，应该尽量尽早的让实现模型的人，也早点参与到建模中。如果他们投资了自己的精力到建模中，自然也会更加认可模型，更加明白如何实现模型。

总之，在团队里，不要把建模和实现模型做得太过于割裂。

## 建模文档里很多值对象、服务什么的都没有定义，也没有详细的流程图，怎么代码实现？

领域模型的文档不等于详细设计的文档，能够说清出领域模型大体是什么样子，如何解决领域问题就够了，不可能做到详细设计那个程度的。在实现领域模型的时候，需要研发再去补充很多模型的细节，以及模型之外的具体技术实现细节。

即使不使用 DDD，即使写详细设计，也不会把详细设计稳当写到像代码一样细致。那样做的话，还不如直接把代码写出来。

## DDD 有代码规范吗？

DDD 没有代码规范。在实现领域模型的时候，唯一的要求就是代码要和模型对应起来，用代码实现模型。为了更好的达到这个目的，结合不同的程序语言框架，会有一些经验或者模式，但这些模式并不是硬性的规范。到了具体的对象、函数、变量命名等细节上，更是没有统一的规范。

建议团队早期多把注意力放在建模和模型实现上，在实现过程中通过团队间的协作，自然形成团队的规范。如果一开始就强调编码规范，会导致程序员们过分关注代码的形式，而忽略了建模和模型实现的本质。极端情况下，一些团队写出的代码，乍一看像是 DDD，因为它采用了大量 DDD 习惯的命名之类的，但是深究下去却完全没有建模和实现模型的过程，完全就不是 DDD。这种假 DDD，不仅得不到 DDD 的好处，还因为要让程序员多付出努力去遵循所谓“DDD 的规范”导致实际开发效率下降。这也是这种虚假的 DDD 带来损害，导致一些人对 DDD 存在误解，讨厌 DDD 的原因。
